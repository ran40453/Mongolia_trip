<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>旅程助手</title>

    <!-- Tailwind + Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0"
      rel="stylesheet"
    />

    <!-- 拆出去的自訂樣式 -->
    <?!= include('css'); ?>
  </head>
  <body class="bg-[#F2F2F7]">
    <!-- Loading Overlay -->
    <div
      id="loading"
      class="fixed inset-0 z-[100] bg-white flex flex-col items-center justify-center transition-opacity duration-300"
    >
      <div class="loader mb-4"></div>
      <p class="text-gray-500 text-sm font-medium animate-pulse">
        正在同步雲端資料...
      </p>
    </div>

    <!-- Header -->
    <header
      class="sticky top-0 z-40 glass px-5 py-4 flex justify-between items-end shadow-sm"
    >
      <div>
        <p
          class="text-[10px] text-gray-500 font-bold uppercase tracking-wider mb-0.5"
        >
          Travel App
        </p>
        <h1
          id="header-title"
          class="text-2xl font-bold text-gray-900 leading-none"
        >
          行程
        </h1>
      </div>
      <div id="header-action" class="hidden"></div>
    </header>

    <!-- Main View 容器（之後由 js.html 動態渲染） -->
    <main id="app" class="p-4 min-h-screen"></main>

    <!-- Tab Bar -->
    <nav class="fixed bottom-0 left-0 right-0 z-50 glass pb-safe">
      <div
        class="max-w-md mx-auto flex justify-around items-center h-16 pb-1"
      >
        <button
          class="tab-btn w-full flex flex-col items-center text-blue-600"
          data-tab="events"
        >
          <span class="material-symbols-outlined text-[26px]">
            calendar_month
          </span>
          <span class="text-[10px] font-medium mt-0.5">行程</span>
        </button>
        <button
          class="tab-btn w-full flex flex-col items-center text-gray-400"
          data-tab="flights"
        >
          <span class="material-symbols-outlined text-[26px]">flight</span>
          <span class="text-[10px] font-medium mt-0.5">航班</span>
        </button>

        <button
          class="tab-btn w-full flex flex-col items-center text-gray-400"
          data-tab="landmarks"
        >
          <span class="material-symbols-outlined text-[26px]">place</span>
          <span class="text-[10px] font-medium mt-0.5">地標</span>
        </button>

        <button
          class="tab-btn w-full flex flex-col items-center text-gray-400"
          data-tab="packing"
        >
          <span class="material-symbols-outlined text-[26px]">checklist</span>
          <span class="text-[10px] font-medium mt-0.5">清單</span>
        </button>
        
        <button
          class="tab-btn w-full flex flex-col items-center text-gray-400"
          data-tab="expenses"
        >
          <span class="material-symbols-outlined text-[26px]"
            >account_balance_wallet</span
          >
          <span class="text-[10px] font-medium mt-0.5">記帳</span>
        </button>
      </div>
    </nav>

    <!-- Edit Modal -->
    <div id="modal" class="fixed inset-0 z-[60] hidden">
      <!-- 背景 -->
      <div
        id="modal-bg"
        class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity opacity-0"
      ></div>

      <!-- Bottom Sheet -->
      <div
        id="modal-sheet"
        class="absolute bottom-0 left-0 right-0 bg-white rounded-t-[30px] p-6 transform transition-transform duration-300 translate-y-full"
      >
        <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6"></div>
        <h3 class="text-xl font-bold text-gray-900 mb-6">編輯行程</h3>

        <div class="space-y-4">
          <input type="hidden" id="inp-id" />

          <div>
            <label
              class="text-xs font-bold text-gray-400 uppercase tracking-wide"
              >標題</label
            >
            <input
              id="inp-title"
              class="w-full mt-1 bg-gray-100 p-3 rounded-xl font-medium focus:bg-white focus:ring-2 ring-blue-500 outline-none transition-all"
              placeholder="行程標題"
            />
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div>
              <label
                class="text-xs font-bold text-gray-400 uppercase tracking-wide"
                >時間</label
              >
              <input
                id="inp-time"
                class="w-full mt-1 bg-gray-100 p-3 rounded-xl focus:bg-white focus:ring-2 ring-blue-500 outline-none transition-all"
                placeholder="例如 07:30–09:00"
              />
            </div>
            <div>
              <label
                class="text-xs font-bold text-gray-400 uppercase tracking-wide"
                >地點</label
              >
              <input
                id="inp-place"
                class="w-full mt-1 bg-gray-100 p-3 rounded-xl focus:bg-white focus:ring-2 ring-blue-500 outline-none transition-all"
                placeholder="地點名稱"
              />
            </div>
          </div>

          <div>
            <label
              class="text-xs font-bold text-gray-400 uppercase tracking-wide"
              >備註</label
            >
            <textarea
              id="inp-note"
              rows="3"
              class="w-full mt-1 bg-gray-100 p-3 rounded-xl focus:bg-white focus:ring-2 ring-blue-500 outline-none transition-all"
              placeholder="可填寫移動方式、天氣、備註等"
            ></textarea>
          </div>
        </div>

        <div class="mt-6 flex gap-3">
          <button
            id="modal-cancel"
            class="flex-1 py-3 rounded-2xl bg-gray-100 text-gray-700 font-medium"
          >
            取消
          </button>
          <button
            id="modal-save"
            class="flex-1 py-3 rounded-2xl bg-blue-600 text-white font-semibold shadow-sm"
          >
            儲存
          </button>
        </div>
      </div>
    </div>

    <!-- 後端注入資料 + 啟動前端 JS -->
    <script>
      // 先給一個 DEPLOY_TAG，讓 js.html 的安全檢查可以通過
      window.__CW_DEPLOY_TAG = window.__CW_DEPLOY_TAG || 'MONGOLIA_TRIP_V1';

      // 把 Apps Script 後端塞進來的 initialData 丟到前端
      // （code.js 的 doGet 會提供 initialData）
      window.INITIAL_DATA = <?!= JSON.stringify(initialData) ?> || {};
    </script>
    <?!= include('js'); ?>
  </body>
</html>